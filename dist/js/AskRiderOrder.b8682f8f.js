(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AskRiderOrder"],{"0fc9":function(t,e,i){var r=i("3a38"),n=Math.max,s=Math.min;t.exports=function(t,e){return t=r(t),t<0?n(t+e,0):s(t,e)}},1654:function(t,e,i){"use strict";var r=i("71c1")(!0);i("30f1")(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=r(e,i),this._i+=t.length,{value:t,done:!1})})},1691:function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},"241e":function(t,e,i){var r=i("25eb");t.exports=function(t){return Object(r(t))}},"25eb":function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},"30f1":function(t,e,i){"use strict";var r=i("b8e3"),n=i("63b6"),s=i("9138"),o=i("35e8"),a=i("481b"),c=i("8f60"),u=i("45f2"),f=i("53e2"),l=i("5168")("iterator"),d=!([].keys&&"next"in[].keys()),p="@@iterator",v="keys",h="values",_=function(){return this};t.exports=function(t,e,i,b,m,g,y){c(i,e,b);var O,k,x,L=function(t){if(!d&&t in C)return C[t];switch(t){case v:return function(){return new i(this,t)};case h:return function(){return new i(this,t)}}return function(){return new i(this,t)}},w=e+" Iterator",T=m==h,S=!1,C=t.prototype,j=C[l]||C[p]||m&&C[m],A=j||L(m),P=m?T?L("entries"):A:void 0,I="Array"==e&&C.entries||j;if(I&&(x=f(I.call(new t)),x!==Object.prototype&&x.next&&(u(x,w,!0),r||"function"==typeof x[l]||o(x,l,_))),T&&j&&j.name!==h&&(S=!0,A=function(){return j.call(this)}),r&&!y||!d&&!S&&C[l]||o(C,l,A),a[e]=A,a[w]=_,m)if(O={values:T?A:L(h),keys:g?A:L(v),entries:P},y)for(k in O)k in C||s(C,k,O[k]);else n(n.P+n.F*(d||S),e,O);return O}},"32fc":function(t,e,i){var r=i("e53d").document;t.exports=r&&r.documentElement},"335c":function(t,e,i){var r=i("6b4c");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},"36c3":function(t,e,i){var r=i("335c"),n=i("25eb");t.exports=function(t){return r(n(t))}},"3a38":function(t,e){var i=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:i)(t)}},"3ecf":function(t,e,i){"use strict";var r=i("cca7"),n=i.n(r);n.a},"40c3":function(t,e,i){var r=i("6b4c"),n=i("5168")("toStringTag"),s="Arguments"==r(function(){return arguments}()),o=function(t,e){try{return t[e]}catch(i){}};t.exports=function(t){var e,i,a;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=o(e=Object(t),n))?i:s?r(e):"Object"==(a=r(e))&&"function"==typeof e.callee?"Arguments":a}},"41ea":function(t,e,i){"use strict";i.d(e,"b",function(){return r}),i.d(e,"a",function(){return n});var r=0,n=1},"45f2":function(t,e,i){var r=i("d9f6").f,n=i("07e3"),s=i("5168")("toStringTag");t.exports=function(t,e,i){t&&!n(t=i?t:t.prototype,s)&&r(t,s,{configurable:!0,value:e})}},"469f":function(t,e,i){i("6c1c"),i("1654"),t.exports=i("7d7b")},"481b":function(t,e){t.exports={}},"4e8a":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"aro_page",staticClass:"aro_page"},[i("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[i("van-loading",{directives:[{name:"show",rawName:"v-show",value:!t.isInit,expression:"!isInit"}],staticClass:"aro_loading"}),i("div",{staticClass:"aro_district"},t._l(t.districtList,function(e,r){return i("div",{key:r,staticClass:"aro_district-item",on:{click:function(e){return t.ToActive(t.districtList,r)}}},[i("div",{class:{active:e.active}},[t._v(t._s(e.text))])])}),0),i("ul",{ref:"aro_list",staticClass:"aro_list"},t._l(t.askOrderList,function(e,r){return i("orderItem",{key:r,tag:"li",attrs:{data:e,riderAsk:"未接单"},on:{ToAccept:function(e){return t.ToAccept(r)}}})}),1)],1)],1)},n=[],s=(i("ac6a"),i("f499")),o=i.n(s),a=i("5d73"),c=i.n(a),u=i("2b0e"),f=i("1fba"),l=i("9e6f"),d=i("f20c"),p=i("8c7f"),v=(i("41ea"),i("b970"));u["a"].use(v["c"]),u["a"].use(v["b"]);var h={name:"AskOrder",data:function(){return{isInit:!1,isLoading:!1,askOrderList:[],districtList:[{text:"全部",active:!0,district:""},{text:"西区",active:!1,district:"西区"},{text:"北区",active:!1,district:"北区"},{text:"南区",active:!1,district:"南区"}],params:null,websocket:null,scroll:0}},activated:function(){this.$refs.aro_page.scrollTop=this.scroll},created:function(){var t=this;Object(d["h"])(),this._initWebsocket(),this._getList(this.districtList[0].district),this.$nextTick(function(){t._initScroll()})},methods:{_initScroll:function(){this.aro_page=new f["a"](this.$refs.aro_page,{click:!0})},ToDetail:function(t){var e=this.$refs.aro_page.scrollTop;this.scroll=e,Object(d["m"])("order_id",this.askOrderList[t].serial_id),this.$router.push("/riderOrderDetail")},onRefresh:function(){var t=this;setTimeout(function(){t.$toast("刷新成功"),t.isLoading=!1,Object(p["j"])(t.params).then(function(e){t.askOrderList=Object(d["b"])(e)}).catch(function(){}),t.$nextTick(function(){t._initScroll()})},500)},_initWebsocket:function(){var t=this,e="ws://101.132.181.245:9501";this.websocket=new WebSocket(e),this.websocket.onopen=function(){Object(d["o"])(t.websocket)},this.websocket.onclose=function(){console.log("Disconnected")},this.websocket.onmessage=function(e){var i=JSON.parse(e.data);"cancel"==i.message?t.getCancel(i):"generate"==i.message?t.getGenerate(i):"delivery"==i.message&&t.getDelivery(i),console.log("Retrieved data from server: "+i.message)},this.websocket.onerror=function(t){console.log("Error occured: "+t.data)}},getCancel:function(t){var e=!0,i=!1,r=void 0;try{for(var n,s=c()(this.askOrderList);!(e=(n=s.next()).done);e=!0){var o=n.value;o["serial_id"]==t.id&&this.askOrderList.splice(this.askOrderList.indexOf(o),1)}}catch(a){i=!0,r=a}finally{try{e||null==s.return||s.return()}finally{if(i)throw r}}},getDelivery:function(t){var e=!0,i=!1,r=void 0;try{for(var n,s=c()(this.askOrderList);!(e=(n=s.next()).done);e=!0){var o=n.value;o["serial_id"]==t.id&&this.askOrderList.splice(this.askOrderList.indexOf(o),1)}}catch(a){i=!0,r=a}finally{try{e||null==s.return||s.return()}finally{if(i)throw r}}},getGenerate:function(t){t.timestamp=t.time,t.created_at=Object(d["n"])(t.time),t.serial_id=t.id,this.askOrderList.unshift(t)},ToAccept:function(t){var e=this;v["a"].confirm({message:"确定要接下该单吗？"}).then(function(){v["a"].alert({message:"接单成功"}),e._sendWebsocket(t),e.saveOrder(t),e.askOrderList.splice(t,1)}).catch(function(){})},saveOrder:function(t){var e=o()(this.askOrderList[t]);Object(d["m"])("accept_order",e)},_sendWebsocket:function(t){var e=this.askOrderList[t].serial_id,i=JSON.parse(Object(d["g"])("rider_info")).phone;this.websocket.send('{"url":"/order/delivery","serial_id":'+e+',"deliveryphone": '+i+"}")},ToActive:function(t,e){this._getList(this.districtList[e].district),t.forEach(function(t){t.active=!1}),t[e].active=!0},_getList:function(t){var e=this;this.params=""==t?{status:"未接单"}:{status:"未接单",district:t},Object(p["j"])(this.params).then(function(t){e.askOrderList=Object(d["b"])(t)}).catch(function(){v["a"].alert({message:"获取列表失败"})}),this.isInit=!0},RouteTo:d["a"]},components:{orderItem:l["a"]}},_=h,b=(i("e05a"),i("2877")),m=Object(b["a"])(_,r,n,!1,null,"ea6d30f0",null);e["default"]=m.exports},"50ed":function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},5168:function(t,e,i){var r=i("dbdb")("wks"),n=i("62a0"),s=i("e53d").Symbol,o="function"==typeof s,a=t.exports=function(t){return r[t]||(r[t]=o&&s[t]||(o?s:n)("Symbol."+t))};a.store=r},"53e2":function(t,e,i){var r=i("07e3"),n=i("241e"),s=i("5559")("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=n(t),r(t,s)?t[s]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?o:null}},5559:function(t,e,i){var r=i("dbdb")("keys"),n=i("62a0");t.exports=function(t){return r[t]||(r[t]=n(t))}},"5b4e":function(t,e,i){var r=i("36c3"),n=i("b447"),s=i("0fc9");t.exports=function(t){return function(e,i,o){var a,c=r(e),u=n(c.length),f=s(o,u);if(t&&i!=i){while(u>f)if(a=c[f++],a!=a)return!0}else for(;u>f;f++)if((t||f in c)&&c[f]===i)return t||f||0;return!t&&-1}}},"5d73":function(t,e,i){t.exports=i("469f")},"62a0":function(t,e){var i=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+r).toString(36))}},"6c1c":function(t,e,i){i("c367");for(var r=i("e53d"),n=i("35e8"),s=i("481b"),o=i("5168")("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var u=a[c],f=r[u],l=f&&f.prototype;l&&!l[o]&&n(l,o,u),s[u]=s.Array}},"71c1":function(t,e,i){var r=i("3a38"),n=i("25eb");t.exports=function(t){return function(e,i){var s,o,a=String(n(e)),c=r(i),u=a.length;return c<0||c>=u?t?"":void 0:(s=a.charCodeAt(c),s<55296||s>56319||c+1===u||(o=a.charCodeAt(c+1))<56320||o>57343?t?a.charAt(c):s:t?a.slice(c,c+2):o-56320+(s-55296<<10)+65536)}}},"7cd6":function(t,e,i){var r=i("40c3"),n=i("5168")("iterator"),s=i("481b");t.exports=i("584a").getIteratorMethod=function(t){if(void 0!=t)return t[n]||t["@@iterator"]||s[r(t)]}},"7d7b":function(t,e,i){var r=i("e4ae"),n=i("7cd6");t.exports=i("584a").getIterator=function(t){var e=n(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return r(e.call(t))}},"7e90":function(t,e,i){var r=i("d9f6"),n=i("e4ae"),s=i("c3a1");t.exports=i("8e60")?Object.defineProperties:function(t,e){n(t);var i,o=s(e),a=o.length,c=0;while(a>c)r.f(t,i=o[c++],e[i]);return t}},8436:function(t,e){t.exports=function(){}},"8f60":function(t,e,i){"use strict";var r=i("a159"),n=i("aebd"),s=i("45f2"),o={};i("35e8")(o,i("5168")("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=r(o,{next:n(1,i)}),s(t,e+" Iterator")}},9138:function(t,e,i){t.exports=i("35e8")},"9cec":function(t,e,i){},"9e6f":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"item",on:{click:t.ToDetail}},[i("div",{staticClass:"item_head"},[t._m(0),i("p",{staticClass:"order_id"},[t._v("订单编号："+t._s(t.data.timestamp+""+t.data.serial_id))]),t.ask||t.wait||t.riderAsk||t.riderPast||t.riderWait?i("p",{staticClass:"order_status"},[t._v(t._s(t.data.status))]):t._e()]),i("div",{staticClass:"item_line"}),i("div",{staticClass:"item_content"},[i("p",{staticClass:"time"},[t._v("下单时间："+t._s(t.data.created_at))]),i("p",{staticClass:"location"},[t._v("地址："+t._s(t.data.district+t.data.dormtype+t.data.building+"栋"+t.data.dorm))]),t.wait||t.finish?i("p",{staticClass:"phone"},[t._v("云鸽电话： "+t._s(t.data.deliveryphone))]):t._e(),t.riderAsk||t.riderPast||t.riderWait?i("p",{staticClass:"phone"},[t._v("用户电话： "+t._s(t.data.userphone))]):t._e(),t.wait?i("p",{staticClass:"arrive_time"},[t._v("预计"+t._s(t.data.time)+"分钟到达")]):t._e(),t.finish?i("p",{staticClass:"finish_text"},[t._v("已完成")]):t._e(),t.cancel?i("p",{staticClass:"cancel_text"},[t._v("已取消")]):t._e(),t.ask?i("input",{ref:"cancel_btn",staticClass:"cancel_btn",attrs:{type:"button",value:"取消订单"},on:{click:function(e){return e.stopPropagation(),t.ToCancel(e)}}}):t._e(),t.riderAsk?i("input",{ref:"accept_btn",staticClass:"accept_btn",attrs:{type:"button",value:"接单"},on:{click:function(e){return e.stopPropagation(),t.ToAccept(e)}}}):t._e()]),t.wait?i("input",{staticClass:"confirm_btn",attrs:{type:"button",value:"确认送达"},on:{click:function(e){return e.stopPropagation(),t.ToConfirmOrder(e)}}}):t._e()])])},n=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"img_wrapper"},[r("img",{attrs:{src:i("d7db"),alt:"dinning_room"}})])}],s=i("f20c"),o={name:"Item",props:["data","wait","ask","finish","cancel","riderAsk","riderPast","riderWait"],methods:{ToConfirmOrder:function(){this.$emit("ToConfirmOrder")},ToDetail:function(){Object(s["m"])("order_id",this.data.serial_id),this.$router.push("/orderDetail")},ToCancel:function(){this.$emit("ToCancel")},ToAccept:function(){this.$emit("ToAccept")}}},a=o,c=(i("3ecf"),i("2877")),u=Object(c["a"])(a,r,n,!1,null,"289acd49",null);e["a"]=u.exports},a159:function(t,e,i){var r=i("e4ae"),n=i("7e90"),s=i("1691"),o=i("5559")("IE_PROTO"),a=function(){},c="prototype",u=function(){var t,e=i("1ec9")("iframe"),r=s.length,n="<",o=">";e.style.display="none",i("32fc").appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write(n+"script"+o+"document.F=Object"+n+"/script"+o),t.close(),u=t.F;while(r--)delete u[c][s[r]];return u()};t.exports=Object.create||function(t,e){var i;return null!==t?(a[c]=r(t),i=new a,a[c]=null,i[o]=t):i=u(),void 0===e?i:n(i,e)}},a21f:function(t,e,i){var r=i("584a"),n=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(t){return n.stringify.apply(n,arguments)}},b447:function(t,e,i){var r=i("3a38"),n=Math.min;t.exports=function(t){return t>0?n(r(t),9007199254740991):0}},b8e3:function(t,e){t.exports=!0},c367:function(t,e,i){"use strict";var r=i("8436"),n=i("50ed"),s=i("481b"),o=i("36c3");t.exports=i("30f1")(Array,"Array",function(t,e){this._t=o(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,n(1)):n(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])},"values"),s.Arguments=s.Array,r("keys"),r("values"),r("entries")},c3a1:function(t,e,i){var r=i("e6f3"),n=i("1691");t.exports=Object.keys||function(t){return r(t,n)}},cca7:function(t,e,i){},d7db:function(t,e,i){t.exports=i.p+"img/head.ff86e3ae.jpg"},dbdb:function(t,e,i){var r=i("584a"),n=i("e53d"),s="__core-js_shared__",o=n[s]||(n[s]={});(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:r.version,mode:i("b8e3")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},e05a:function(t,e,i){"use strict";var r=i("9cec"),n=i.n(r);n.a},e6f3:function(t,e,i){var r=i("07e3"),n=i("36c3"),s=i("5b4e")(!1),o=i("5559")("IE_PROTO");t.exports=function(t,e){var i,a=n(t),c=0,u=[];for(i in a)i!=o&&r(a,i)&&u.push(i);while(e.length>c)r(a,i=e[c++])&&(~s(u,i)||u.push(i));return u}},f499:function(t,e,i){t.exports=i("a21f")}}]);
//# sourceMappingURL=AskRiderOrder.b8682f8f.js.map